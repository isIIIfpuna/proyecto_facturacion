<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Venta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="p-4">
    <div class="container p-0">
        <h3 class="text-center text-white p-2">Ventas</h3>

        <div class="row m-0">
            <div class="col-md-4 bg-warning p-3">
                <p><strong>Nro Registro:</strong> 0</p>
                <p>XXXXX-XX: ********** XXX: **********</p>
                <p><strong>Dirección:</strong> Avn España, Asunción Paraguay</p>
                <p><strong>Nro:</strong> 212356</p>
            </div>
            <div class="col-md-4 bg-warning p-3">
                <p><strong>Factura Nro:</strong> 001-001-12345</p>
                <p><strong>Fecha Factura:</strong> <span id="fechaFactura"></span></p>
                <p><strong>RUC-CI:</strong> 5028491-6</p>
                <p><strong>Timbrado:</strong> **********</p>
            </div>
            <div class="col-md-4 bg-warning p-3">
                <p><strong>XXX.XXX.XXXX</strong></p>
                <p>Fecha Facturación</p>
            </div>
        </div>

        <form class="row m-0 text-white" id="formCliente">
            <div class="col-md bg-warning p-3">
                <div class="mb-2">
                    <label for="nombre" class="form-label"><strong>Nombre:</strong></label>
                    <input type="text" id="nombre" name="nombre" class="form-control" required>
                </div>
                <div class="mb-2">
                    <label for="email" class="form-label"><strong>Email:</strong></label>
                    <input type="email" id="email" name="email" class="form-control" required>
                </div>
                <div class="mb-2">
                    <label for="telefono" class="form-label"><strong>Teléfono:</strong></label>
                    <input type="tel" id="telefono" name="telefono" class="form-control" required>
                </div>
                <div class="mb-2">
                    <label for="ruc" class="form-label"><strong>RUC-CI:</strong></label>
                    <input type="text" id="ruc" name="ruc" class="form-control" required>
                </div>
            </div>

            <div class="col-md-6 bg-warning p-3">
                <label><strong>Tipo de Pago:</strong></label>
                <div>
                    <input type="radio" name="tipoPago" id="contado" value="contado" checked> 
                    <label for="contado">Contado</label>
                    <input type="radio" name="tipoPago" id="credito" value="credito" class="ms-3"> 
                    <label for="credito">Crédito</label>
                </div>

                <div id="opcionesCredito" class="mt-3 p-3 bg-success text-white d-none">
                    <label for="cuotas"><strong>Cantidad de Cuotas:</strong></label>
                    <input type="number" id="cuotas" class="form-control mb-2" min="1">

                    <label for="diasCobro"><strong>Ingrese Días de Cobro:</strong></label>
                    <input type="text" id="diasCobro" class="form-control" placeholder="Ej: 30,45,60,90">
                </div>
            </div>

            <h4 class="text-center text-white p-2 mt-3">Detalle Venta</h4>

            <table class="table table-bordered bg-white text-dark" id="tablaDetalle">
                <thead class="table-secondary">
                    <tr>
                        <th>Seleccionar</th>
                        <th>Producto</th>
                        <th>Descripción</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="checkbox" class="form-check-input seleccionar"></td>
                        <td>Prueba1</td>
                        <td>Prueba Producto1</td>
                        <td class="precio">50000</td>
                        <td><input type="number" class="form-control cantidad" min="0" style="width: 80px;"></td>
                        <td class="subtotal">0</td>
                    </tr>
                    <tr>
                        <td><input type="checkbox" class="form-check-input seleccionar"></td>
                        <td>Prueba2</td>
                        <td>Prueba Producto2</td>
                        <td class="precio">60000</td>
                        <td><input type="number" class="form-control cantidad" min="0" style="width: 80px;"></td>
                        <td class="subtotal">0</td>
                    </tr>
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th class="text-center">TOTAL</th>
                        <th id="totalGeneral" class="total-final">0</th>
                    </tr>
                </tbody>
            </table>
            <div class="d-flex justify-content-between align-items-center mt-3">
                <button class="btn btn-secondary" onclick="window.location.href='listar-ventas.html'">Atrás</button>
                <button class="btn btn-success">Guardar</button>
            </div>      
        </form>
    </div>

    <script>
        // Mostrar fecha actual
        const fechaHoy = new Date().toLocaleDateString("es-ES");
        document.getElementById("fechaFactura").textContent = fechaHoy;

        document.addEventListener("DOMContentLoaded", function () {
            const contadoRadio = document.getElementById("contado");
            const creditoRadio = document.getElementById("credito");
            const opcionesCredito = document.getElementById("opcionesCredito");

            function toggleOpcionesCredito() {
                opcionesCredito.classList.toggle("d-none", !creditoRadio.checked);
            }

            contadoRadio.addEventListener("change", toggleOpcionesCredito);
            creditoRadio.addEventListener("change", toggleOpcionesCredito);

            // --- TOTAL DINÁMICO ---
            function recalcularTotales() {
                let total = 0;
                const filas = document.querySelectorAll("#tablaDetalle tbody tr:not(:last-child)");

                filas.forEach((fila) => {
                    const checkbox = fila.querySelector(".seleccionar");
                    const precio = parseInt(fila.querySelector(".precio")?.textContent || 0);
                    const cantidadInput = fila.querySelector(".cantidad");
                    const cantidad = parseInt(cantidadInput?.value) || 0;
                    const subtotalCell = fila.querySelector(".subtotal");

                    const subtotal = precio * cantidad;
                    subtotalCell.textContent = subtotal;

                    if (checkbox && checkbox.checked) {
                        total += subtotal;
                    }
                });

                document.getElementById("totalGeneral").textContent = total;
            }

            // Eventos
            document.querySelectorAll(".seleccionar").forEach(cb => {
                cb.addEventListener("change", recalcularTotales);
            });

            document.querySelectorAll(".cantidad").forEach(input => {
                input.addEventListener("input", recalcularTotales);
            });

            // Calcular al iniciar
            recalcularTotales();
        });
    </script>
</body>
</html>
